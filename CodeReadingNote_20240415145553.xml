<?xml version="1.0" encoding="UTF-8"?>
<topics>
  <topic>
    <name>gluten Injector</name>
    <note>sparkPlan.transform(rule)会递归的向树的所有节点应用rule</note>
    <updatedAt>2024-04-15 14:34:32</updatedAt>
    <topicLines>
      <topicLine>
        <line>236</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>每个 injector 都添加到SparkSessionExtension</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>265</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>QueryStagePrepRule的实现QueryStagePrepOverrides包含FallbackOnANSIMode,FallbackMultiCodegens</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>141</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/columnar/TransformHintRule.scala</url>
        <note>gluten不支持ANSI，全部plan标记为不支持</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/columnar/TransformHintRule.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>150</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/columnar/TransformHintRule.scala</url>
        <note>FallbackMultiCodegens。默认columnar physicalJoinOptimize为false，那么就是空逻辑</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/columnar/TransformHintRule.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>266</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>ColumnarOverrideRules  规则，Spark 调用他的两个方法preColumnarTransitions和postColumnarTransitions，具体流程见笔记 spark/class/ColumnarRule</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>845</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</url>
        <note>preColumnarTransitions将 SparkPlan 实例替换为 columnar operator</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>849</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</url>
        <note>使用所有的gluten rule来转换plan</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>222</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/columnar/TransformHintRule.scala</url>
        <note>PlanOneRowRelation .gluten不支持ouput relation为空的情况，这个rule给加了 fake column</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/columnar/TransformHintRule.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>250</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/columnar/TransformHintRule.scala</url>
        <note>在plan里不包含count1()和sum1()时，输出为空的节点打标不支持transform。后面支持了，将删除这个和上个 rule</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/columnar/TransformHintRule.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>276</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/columnar/TransformHintRule.scala</url>
        <note>AddTransformHintRule. 将遍历节点及所有的children，执行XXXExecTransformer.validate检查是否支持offload，并将结果作为tag给plan标记上</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/columnar/TransformHintRule.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>817</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</url>
        <note>将 sparkplan转换为 gluten 的 transformer</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>287</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</url>
        <note>使用 transformer plan 替换 spark plan，新的 transformer plan 不包含之前的tag</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>818</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</url>
        <note>PartitionFilters .空实现</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>819</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</url>
        <note>EnsureLocalSortRequirements  。sort 算子相关</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>822</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</url>
        <note>gluten 开发者自定义的rule，默认为空</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>854</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</url>
        <note>使用 ExpandFallbackPolicy 进行 transform</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>244</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/ExpandFallbackPolicy.scala</url>
        <note>是否需要将整个spark plan Fallback 到 vanilla spark plan，需要则插入 c2r r2c 打tag</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/ExpandFallbackPolicy.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>829</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</url>
        <note>非Fallback执行的rule</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>838</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</url>
        <note>最后应用的rule</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/extension/ColumnarOverrides.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>267</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>JoinSelectionOverrides</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>268</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>OthersExtensionOverrides  backend提供的一些rule</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
    </topicLines>
  </topic>
  <topic>
    <name>gluten driver</name>
    <note>负责对Spark物理计划进行校验（validate）并转换(transform)成Substrait计划</note>
    <updatedAt>2024-04-08 19:43:58</updatedAt>
    <topicLines>
      <topicLine>
        <line>47</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>spark 触发 Gluten plugin 初始化</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>60</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>向spark注册Gluten listener，监听SparkListenerSQLExecutionStart和SparkListenerSQLExecutionEnd GlutenBuildInfoEvent GlutenPlanFallbackEvent事件</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>69</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>将spark conf赋值给Gluten conf，例如spark.memory.offHeap.size</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>137</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>如果conf没有指定SparkSessionExtensions，将配置为gluten定义的io.glutenproject.GlutenSessionExtensions，GlutenSessionExtensions负责将gluten自定义的规则注入到Spark session state，
然后SQL查询便会使用这些规则</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>72</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>初始化velox backend，包括Gluten backend api和Native backend</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>134</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/backends-velox/src/main/scala/io/glutenproject/backendsapi/velox/ListenerApiImpl.scala</url>
        <note>加载lib so文件</note>
        <relativePath>backends-velox/src/main/scala/io/glutenproject/backendsapi/velox/ListenerApiImpl.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>153</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/backends-velox/src/main/scala/io/glutenproject/backendsapi/velox/ListenerApiImpl.scala</url>
        <note>初始化Native backend</note>
        <relativePath>backends-velox/src/main/scala/io/glutenproject/backendsapi/velox/ListenerApiImpl.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>74</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>将GlutenSQLAppStatusListener注册到spark的 event bus，</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>25</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/org/apache/spark/listener/GlutenSQLAppStatusListener.scala</url>
        <note>GlutenSQLAppStatusListener负责在 executor 的生命周期的时间点通知 gluten driver进行资源的释放和分配。问题：看方法名是RPC调用，但spark driver应该和gluten driver在一个进程</note>
        <relativePath>gluten-core/src/main/scala/org/apache/spark/listener/GlutenSQLAppStatusListener.scala</relativePath>
      </topicLine>
      <topicLine>
        <line>75</line>
        <inProject>true</inProject>
        <url>file:///Users/panning/VSProjects/glutenNvelox_CE/incubator-gluten/gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</url>
        <note>根据配置反射创建 expressiontranformer</note>
        <relativePath>gluten-core/src/main/scala/io/glutenproject/GlutenPlugin.scala</relativePath>
      </topicLine>
    </topicLines>
  </topic>
</topics>

